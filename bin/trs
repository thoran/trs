#!/usr/bin/env ruby
# trs

# 20180327
# 0.8.1-bells_and_whistles edition

# Note: This branch was created by cherry picking the changes on master which caused the version to move from 0.8.0 to 0.8.1 onto master at 0.7.0 to create the bells_and_whistles branch.

# Changes since 0.6:
# 1. Removed setting of defaults for programs_directory, since this is now done in ToyRobotSimulator::defaults.
# 2. Removed setting of defaults for tabletop_dimensions, since this is now done in ToyRobotSimulator::defaults.
# 3. Removed setting of defaults for number_of_toy_robots, since this is now done in ToyRobotSimulator::defaults.
# and since 0.8.0, but without the changes from 0.7.0 to 0.8.0 which caused the removal of multiple robots and other extras:
# 4. Moved date and version information out of individual files to bin/trs only.
# 5. Made the handling of switches in bin/trs slightly DRYer(sic).

require_relative '../lib/Switches'
require_relative '../lib/ToyRobotSimulator'

switches = Switches.new do |s|
  s.set(:e?, :extras?, default: false)
  s.set(:n, :number_of_toy_robots)
  s.set(:p, :program)
  s.set(:d, :directory, :programs_directory)
  s.set(:r, :random)
  s.set(:t, :tabletop, :tabletop_dimensions)
end

trs = ToyRobotSimulator.new

# The order of setting attributes on ToyRobotSimulator is significant, which probably shouldn't be the case.

[:extras, :program, :programs_directory, :tabletop_dimensions, :number_of_toy_robots, :random].each do |switch|
  switch_value = switches.send(switch)
  trs.send(switch.to_s + '=', switch_value) if switch_value
end

trs.setup
trs.run
